#!/usr/bin/env bash
set -e

DIR="$(cd "$(dirname "$0")" && pwd)"
BIN="$DIR/packages/cli/rust-proxy/target/release/max"

if ! command -v cargo &>/dev/null; then
  echo "Rust is required. Install via: curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh" >&2
  exit 1
fi

if [ ! -f "$BIN" ]; then
  echo "Building max CLI..." >&2
  (cd "$DIR/packages/cli/rust-proxy" && cargo build --release) >&2
fi

MAX_DEV=1 exec "$BIN" "$@"
